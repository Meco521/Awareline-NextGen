/*     */ package awareline.main.mod.implement.misc;
/*     */ import awareline.main.event.events.world.packetEvents.EventPacketReceive;
/*     */ import java.net.URI;
/*     */ import java.util.regex.Matcher;
/*     */ import java.util.regex.Pattern;
/*     */ import net.minecraft.network.Packet;
/*     */ import net.minecraft.network.play.client.C19PacketResourcePackStatus;
/*     */ import net.minecraft.network.play.server.S02PacketChat;
/*     */ import net.minecraft.network.play.server.S18PacketEntityTeleport;
/*     */ import net.minecraft.network.play.server.S27PacketExplosion;
/*     */ import net.minecraft.network.play.server.S2APacketParticles;
/*     */ import net.minecraft.network.play.server.S2BPacketChangeGameState;
/*     */ import net.minecraft.network.play.server.S33PacketUpdateSign;
/*     */ import net.minecraft.network.play.server.S48PacketResourcePackSend;
/*     */ import net.minecraft.util.IChatComponent;
/*     */ 
/*     */ public class AntiExploit extends Module {
/*  18 */   private final Pattern pattern = Pattern.compile(".*\\$\\{[^}]*}.*");
/*     */   
/*     */   public AntiExploit() {
/*  21 */     super("AntiExploit", ModuleType.Misc);
/*     */   }
/*     */ 
/*     */   
/*     */   @EventHandler
/*     */   public void checkExploit(EventPacketReceive e) {
/*  27 */     if (e.getPacket() instanceof S27PacketExplosion) {
/*  28 */       S27PacketExplosion packet = (S27PacketExplosion)e.packet;
/*  29 */       if (Math.abs(packet.field_149152_f) > 99.0F || Math.abs(packet.field_149153_g) > 99.0F || Math.abs(packet.field_149159_h) > 99.0F) {
/*  30 */         processExploit("Explosion", "A");
/*  31 */         e.setCancelled(true);
/*  32 */       } else if (Math.abs(packet.getStrength()) > 99.0F) {
/*  33 */         processExploit("Explosion", "B");
/*  34 */         e.setCancelled(true);
/*     */       } 
/*  36 */     } else if (e.getPacket() instanceof S02PacketChat) {
/*  37 */       S02PacketChat packet = (S02PacketChat)e.packet;
/*  38 */       Matcher matcher = this.pattern.matcher(packet.getChatComponent().getUnformattedText().toLowerCase());
/*  39 */       if (matcher.find()) {
/*  40 */         processExploit("Log4j", "A");
/*  41 */         e.setCancelled(true);
/*     */       } 
/*  43 */     } else if (e.getPacket() instanceof S18PacketEntityTeleport) {
/*  44 */       S18PacketEntityTeleport packet = (S18PacketEntityTeleport)e.packet;
/*  45 */       if (Math.abs(packet.getX()) > 29999984 || Math.abs(packet.getZ()) > 29999984 || Math.abs(packet.getY()) > 29999984) {
/*  46 */         processExploit("Teleport", "A");
/*  47 */         e.setCancelled(true);
/*     */       } 
/*  49 */     } else if (e.getPacket() instanceof S2APacketParticles) {
/*  50 */       S2APacketParticles packet = (S2APacketParticles)e.packet;
/*  51 */       if (Math.abs(packet.getParticleSpeed()) > 10.0F) {
/*  52 */         processExploit("Particle", "A");
/*  53 */         e.setCancelled(true);
/*  54 */       } else if (packet.getParticleCount() > 500) {
/*  55 */         processExploit("Particle", "B");
/*  56 */         e.setCancelled(true);
/*     */       } 
/*  58 */     } else if (e.getPacket() instanceof S2BPacketChangeGameState) {
/*  59 */       S2BPacketChangeGameState packet = (S2BPacketChangeGameState)e.packet;
/*  60 */       if (packet.getGameState() > 5 && (packet.func_149137_d() > 99.0F || packet.getGameState() > 99)) {
/*  61 */         processExploit("GameState", "A");
/*  62 */         e.setCancelled(true);
/*     */       } 
/*  64 */     } else if (e.getPacket() instanceof S33PacketUpdateSign) {
/*  65 */       S33PacketUpdateSign packet = (S33PacketUpdateSign)e.packet;
/*  66 */       for (IChatComponent line : packet.getLines()) {
/*  67 */         if (mc.fontRendererObj.getStringWidth(line.getUnformattedText()) > 100) {
/*  68 */           processExploit("Sign", "A");
/*  69 */           e.setCancelled(true);
/*     */           break;
/*     */         } 
/*     */       } 
/*  73 */     } else if (e.getPacket() instanceof net.minecraft.network.play.server.S43PacketCamera) {
/*  74 */       if (!mc.thePlayer.isSpectator()) {
/*  75 */         processExploit("Camera", "A");
/*  76 */         e.setCancelled(true);
/*     */       } 
/*  78 */     } else if (e.getPacket() instanceof S48PacketResourcePackSend) {
/*  79 */       S48PacketResourcePackSend packet = (S48PacketResourcePackSend)e.packet;
/*     */       try {
/*  81 */         URI uri = new URI(packet.getURL());
/*  82 */         String scheme = uri.getScheme();
/*  83 */         boolean isLevelProtocol = "level".equalsIgnoreCase(scheme);
/*  84 */         boolean isHttpProtocol = "http".equalsIgnoreCase(scheme);
/*  85 */         boolean isHttpsProtocol = "https".equalsIgnoreCase(scheme);
/*     */         
/*  87 */         if (!isHttpProtocol && !isHttpsProtocol && !isLevelProtocol) {
/*  88 */           processExploit("ResourcePack", "A");
/*  89 */           mc.thePlayer.sendQueue.getNetworkManager().sendPacket((Packet)new C19PacketResourcePackStatus(packet.getHash(), C19PacketResourcePackStatus.Action.FAILED_DOWNLOAD));
/*     */           
/*  91 */           e.setCancelled(true);
/*     */         } 
/*     */         
/*  94 */         if (isLevelProtocol && (packet.getURL().contains("..") || !packet.getURL().endsWith("/resources.zip"))) {
/*  95 */           processExploit("ResourcePack", "B");
/*  96 */           mc.thePlayer.sendQueue.getNetworkManager().sendPacket((Packet)new C19PacketResourcePackStatus(packet.getHash(), C19PacketResourcePackStatus.Action.FAILED_DOWNLOAD));
/*     */           
/*  98 */           e.setCancelled(true);
/*     */         }
/*     */       
/* 101 */       } catch (URISyntaxException exception) {
/* 102 */         processExploit("ResourcePack", "C");
/* 103 */         mc.thePlayer.sendQueue.getNetworkManager().sendPacket((Packet)new C19PacketResourcePackStatus(packet.getHash(), C19PacketResourcePackStatus.Action.FAILED_DOWNLOAD));
/*     */         
/* 105 */         e.setCancelled(true);
/*     */       } 
/*     */     } 
/*     */   }
/*     */ 
/*     */   
/*     */   public void processExploit(String module, String type) {
/* 112 */     Helper.sendMessage("The server tried to send exploit packet: " + module + " (type:" + type + ")");
/*     */   }
/*     */ }


/* Location:              C:\Users\Administrator\Downloads\Awareline - NextGen7 release ‎2023‎-12-25-‏11-09-05.jar!\awareline\main\mod\implement\misc\AntiExploit.class
 * Java compiler version: 8 (52.0)
 * JD-Core Version:       1.1.3
 */